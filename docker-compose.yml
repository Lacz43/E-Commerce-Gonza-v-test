services:
    dev:
        build:
            context: .
            target: dev
        container_name: gonzaplus_dev
        ports:
            - "8000:8000"
            - "5173:5173"
        volumes:
            - .:/var/www/html
            - ./storage:/var/www/html/storage
            #- /var/www/html/node_modules
        working_dir: /var/www/html
        tty: true # Permite usar la consola interactiva
        depends_on:
            - db
            - phpmyadmin
        networks:
            - network # ðŸ‘ˆ AsegÃºrate de que el app estÃ© en la misma red que db

    prod:
        build:
            context: .
            target: prod
        container_name: gonzaplus_prod
        volumes:
            - .:/var/www/html
        working_dir: /var/www/html
        tty: true # Permite usar la consola interactiva
        depends_on:
            - db
        networks:
            - network # ðŸ‘ˆ AsegÃºrate de que el app estÃ© en la misma red que db
        expose:
            - "9000"

    web:
        build:
            context: .
            dockerfile: docker/nginx/Dockerfile
        container_name: gonzaplus_web
        volumes:
            - ./docker/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
            - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
        ports:
            - "80:80"
        depends_on:
            - prod
        networks:
            - network
        environment:
            - NGINX_HOST=gonzaplus.local
            - NGINX_PORT=80
        restart: unless-stopped

    db:
        image: mariadb:11.7.2
        container_name: gonzaplus_db
        environment:
            MARIADB_ROOT_PASSWORD: password
            MARIADB_DATABASE: gonza
            MARIADB_USER: admin
            MARIADB_PASSWORD: password
        volumes:
            - db_data:/var/lib/mysql
        ports:
            - "3306:3306" # Puerto local:puerto contenedor
        networks:
            - network

    phpmyadmin:
        image: phpmyadmin/phpmyadmin:latest
        container_name: phpmyadmin
        ports:
            - "8080:80"
        environment:
            PMA_HOST: db
            PMA_PORT: 3306
            PMA_USER: admin
            PMA_PASSWORD: password
            MYSQL_ROOT_PASSWORD: password
        depends_on:
            - db
        networks:
            - network

volumes:
    db_data:

networks:
    network:
        driver: bridge
