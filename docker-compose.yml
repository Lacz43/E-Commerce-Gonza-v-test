services:
    dev:
        build:
            context: .
            dockerfile: docker/Dockerfile.dev
        container_name: gonzaplus_dev
        ports:
            - "8000:8000"
            - "5173:5173"
        volumes:
            - .:/var/www/html
            - ./storage:/var/www/html/storage
        working_dir: /var/www/html
        tty: true # Permite usar la consola interactiva
        depends_on:
            - db
        networks:
            - network # ðŸ‘ˆ AsegÃºrate de que el app estÃ© en la misma red que db

    prod:
        build:
            context: .
            dockerfile: docker/Dockerfile.prod
        container_name: gonzaplus_prod
        ports:
            - "80:80"
        volumes:
            - .:/var/www/html
        working_dir: /var/www/html
        tty: true # Permite usar la consola interactiva
        depends_on:
            - db
            - web
        networks:
            - network # ðŸ‘ˆ AsegÃºrate de que el app estÃ© en la misma red que db

    web:
        image: nginx:1.27.5
        volumes:
            - ./templates:/etc/nginx/templates
        ports:
            - "80:80"
        environment:
            - NGINX_HOST=foobar.com
            - NGINX_PORT=80

    db:
        image: mariadb:11.7.2
        container_name: gonzaplus_db
        environment:
            MARIADB_ROOT_PASSWORD: password
            MARIADB_DATABASE: gonza
            MARIADB_USER: admin
            MARIADB_PASSWORD: password
        volumes:
            - db_data:/var/lib/mysql
        ports:
            - "3306:3306" # Puerto local:puerto contenedor
        networks:
            - network

volumes:
    db_data:

networks:
    network:
        driver: bridge
